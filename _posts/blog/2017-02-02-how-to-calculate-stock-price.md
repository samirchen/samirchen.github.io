---
layout: post
title: 股票交易的价格算法
description: 讨论一下股票交易中，股票的价格是如何计算得来的。
category: blog
tag: reading, investment, stock price
---


股价的形成分为「集合竞价」和「连续竞价」。




## 集合竞价

集合竞价就是在当天还没有成交价的时候，想要入市的投资者可根据前一天的收盘价和对当日股市的预测来输入股票价格设置买入或卖出委托，在这段时间里提交到交易平台的所有委托都是平等的，不需要按照时间优先和价格优先的原则交易，而是按最大成交量的原则来定出股票的价位，这个价位就被称为集合竞价的价位，而这个过程就被称为集合竞价。


### 集合竞价的原则

集合竞价的原则如下：

1. 集合竞价方式下价格优先、时间优先原则体现在交易系统将所有的买入和卖出申报按价格由高到低排出序列，同一价格下的申报原则按交易系统接受的先后顺序排序；
2. 集合竞价过程中，若产生一个以上的基准价格，即有一个以上的价格同时满足集合竞价的 3 个条件时，沪市选取这几个基准价格的中间价格为成交价格，深市则选取离前收盘价最近的价格为成交价格。


### 集合竞价的过程

集合竞价即在某一规定时间内，由投资者按照自己所能接受的心理价格自由地进行买卖申报之报，由交易系统对全部申报按照价格优先、时间优先的原则排序，并在此基础上，找出一个基准价格，使它同时能满足以下 3 个条件：

1. 成交量最大。
2. 高于基准价格的买入申报和低于基准价格的卖出申报全部满足（成交）。
3. 与基准价格相同的买卖双方中有一方申报全部满足（成交）。

该基准价格即被确定为成交价格，集合竞价方式产生成交价格的全部过程，完全由交易系统进行程序化处理，将处理后所产生的成交价格显示出来。

这里通过一个例子来说明。

设股票 G 在开盘前分别有 5 笔买入委托和 6 笔卖出委托，根据价格优先的原则，按买入价格由高至低和卖出价格由低至高的顺序将其分别排列如下：

| 序号  | 委托买入价  | 数量(手)  | - | 序号  | 委托卖出价  | 数量(手)  |
|---|---|---|---|---|---|---|
| 1  | 3.80  | 2  | - | 1  | 3.52  | 5  |
| 2  | 3.76  | 6  | - | 2  | 3.57  | 1  |
| 3  | 3.65  | 4  | - | 3  | 3.60  | 2  |
| 4  | 3.60  | 7  | - | 4  | 3.65  | 6  |
| 5  | 3.54  | 6  | - | 5  | 3.70  | 6  |


按不高于申买价和不低于申卖价的原则，首先可成交第一笔，即 3.80 元买入委托和 3.52 元的卖出委托，若要同时符合申买者和申卖者的意愿，其成交价格必须是在 3.52 元与 3.80 元之间，但具体价格要视以后的成交情况而定。这对委托成交后其它的委托排序如下：


| 序号 | 委托买入价 | 数量(手)| - | 序号 | 委托卖出价 | 数量(手) |
|---|---|---|---|---|---|---|
| 1 |   -  | 0 (第一笔委托买入已全部成交) | - |	1 | 3.52 | 3 (第一笔成交后剩下) |
| 2 | 3.76 | 6 | - | 2 | 3.57 | 1 |
| 3 | 3.65 | 4 | - | 3 | 3.60 | 2 |
| 4 | 3.60 | 7 | - | 4 | 3.65 | 6 |
| 5 | 3.54 | 6 | - | 5 | 3.70 | 6 |

在第一次成交中，由于卖出委托的数量多于买入委托，按交易规则，序号 1 的买入委托 2 手全部成交，序号 1 的卖出委托还剩余 3 手。

第二笔成交情况：序号 2 的买入委托价格为不高于 3.76 元，数量为 6 手。在卖出委托中，序号 1—3 的委托的数量正好为 6 手，其价格意愿也符合要求，正好成交，其成交价格在 3.60—3.76 的范围内，成交数量为 6 手。应注意的是，第二笔成交价格的范围是在第一笔成交价格的范围之内，且区间要小一些。第二笔成交后剩下的委托情况为：

| 序号 | 委托买入价 | 数量(手)| - | 序号 | 委托卖出价 | 数量(手) |
|---|---|---|---|---|---|---|
| 3 | 3.65 | 4 | - | - | - | - |
| 4 | 3.60 | 7 | - | 4 | 3.65 | 6 |
| 5 | 3.54 | 6 | - | 5 | 3.70 | 6 |

第三笔成交情况：序号 3 的买入委托其价格要求不超过 3.65 元，而卖出委托序号 4 的委托价格符合要求，这样序号 3 的买入委托与序号 4 的卖出委托就正好配对成交，其价格为 3.65 元，因卖出委托数量大于买入委托，故序号 4 的卖出委托仅只成交了 4 手。第三笔成交后的委托情况如下：

| 序号 | 委托买入价 | 数量(手)| - | 序号 | 委托卖出价 | 数量(手) |
|---|---|---|---|---|---|---|
| 4 | 3.60 | 7 | - | 4 | 3.65 | 2 |
| 5 | 3.54 | 6 | - | 5 | 3.70 | 6 |


完成以上三笔委托后，因最高买入价为 3.60 元，而最低卖出价为 3.65，买入价与卖出价之间再没有相交部分，所以这一次的集合竞价就已完成，最后一笔的成交价就为集合竞价的平均价格。剩下的其他委托将自动进入开盘后的连续竞价。

在以上过程中，通过一次次配对，成交的价格范围逐渐缩小，而成交的数量逐渐增大，直到最后确定一个具体的成交价格，并使成交量达到最大。在最后一笔配对中，如果买入价和卖出价不相等，其成交价就取两者的平均。

在这次的集合竞价中，三笔委托共成交了 12 手，成交价格为 3.65 元，按照规定，所有这次成交的委托无论是买入还是卖出，其成交价都定为 3.65 元，交易所发布的股票 G 的开盘价就为 3.65 元，成交量 12 手。

当股票的申买价低而申卖价高而导致没有股票成交时，上海股市就将其开盘价空缺，将连续竞价后产生的第一笔价格作为开盘价。而深圳股市对此却另有规定：若最高申买价高于前一交易日的收盘价，就选取该价格为开盘价；若最低申卖价低于前一交易日的收盘价，就选取该价格为开盘价；若最低申买价不高于前一交易日的收盘价、最高申卖价不低于前一交易日的收盘价，则选取前一交易日的收盘价为今日的开盘价。

关于上市和深市集合竞价更多的信息，参考：[集合竞价][3]。



## 连续竞价

连续竞价是指对买卖申报逐笔连续撮合的竞价方式。集合竞价结束后，证券交易所开始当天的正式交易，交易系统按照价格优先、时间优先的原则，确定每笔证券交易的具体价格。

上海证券交易所、深圳证券交易所在正常交易时间即每周一到周五上午 9:30-11:30，下午 01:00-03:00 采用连续竞价方式，接受申报进行撮合。

按照我国证券交易所的有关规定，在无撤单的情况下，委托当日有效。另外，开盘集合竞价期间未成交的买卖申报，自动进入连续竞价。深圳证券交易所还规定，连续竞价期间未成交的买卖申报，自动进人收盘集合竞价。


### 连续竞价的原则


1. 成交时价格优先的原则。
	- 买进申报：较高价格者优先；
	- 卖出申报：较低价格者优先。
2. 成交时间优先的原则。



申买价高于即时揭示最低卖价，以最低申卖价成交；申卖价低于最高申买价，以最高申买价成交。两个委托如果不能全部成交，剩余的继续留在单上，等待下次成交。

价格优先原则表现为：价格较高的买进申报优先于较低的买进申报，价格较低的卖出申报优先于较高的卖出申报。即价格最高的买方报价与价格最低的卖方报价优先于其他一切报价成交。例如，许多股民同时买某只股票，此时该股票的价格是 10 元，如果甲股民输入的买入价格为 10.01 元，则甲股民优先成交。反之也是同理，许多股民同时卖某只股票，此时该股票的价格是 10 元，如果甲股民输入的卖出价格为 9.98 元，则甲股民优先成交。



买卖方向、价格相同的，先申报者优先于后申报者。先后顺序按交易主机接受申报的时间确定。在计算机终端申报竞价时，按计算机主机接受的时间顺序排列；在板牌竞价时，按中介经纪人看到的顺序排列。在无法区分先后时，由中介经纪人组织抽签决定。

时间优先原则表现为：同价位申报，依照申报时序决定优先顺序。电脑申报竞价时，按计算机主机接受的时间顺序排列；书面申报竞价时，按证券经纪商接到书面凭证的顺序排列。例如，如果大家都输入 10.01 元买入某股票，则按照先来后到排队等待成交，即谁先输入的买单，谁就先成交，如果大家都输入 9.98 元卖出，则按照先来后到排队等待成交，即谁先输入的卖单，谁就先成交。这就是时间优先。



### 连续竞价的过程

交易系统按照以下情况产生成交价：

1. 最高买进申报与最低卖出申报相同，则该价格即为成交价格；
2. 买入申报价格高于即时揭示的最低卖出申报价格时，以即时揭示的最低卖出申报价格为成交价；
3. 卖出申报价格低于即时揭示的最高买入申报价格时，以即时揭示的最高买入申报价格为成交价。


这里通过一个例子来说明。

某股票即时揭示的卖出申报价格和数量及买入申报价格和数量如表所示。若此时该股票有一笔买入申报进入交易系统，价格为 15.37 元，数量为 600 股，则应如何成交？


| 买卖方向 | 价格(元) | 数量(股) |
|---|---|---|
| 卖出申报 | 15.37 | 1000 |
| 卖出申报 | 15.36 | 800 |
| 卖出申报 | 15.35 | 100 |
| 买入申报 | 15.34 | 500 |
| 买入申报 | 15.33 | 1000 |
| 买入申报 | 15.32 | 800 |

答案是，买入申报价格高于即时揭示的最低卖出申报价格时，以即时揭示的最低卖出申报价格为成交价，此题买入申报价格为 15.37 元，即时揭示的最低卖出申报价格为 15.35 元，所以应以 15.35 元成交 100 股，以 15.36 元成交 500 股。





关于上市和深市连续竞价更多的信息，参考：[连续竞价][4]。


## 参考

文中内容来自：

- [集合竞价][3]
- [连续竞价][4]



[SamirChen]: http://www.samirchen.com "SamirChen"
[1]: {{ page.url }} ({{ page.title }})
[2]: http://samirchen.com/how-to-calculate-stock-price/
[3]: http://wiki.mbalib.com/wiki/%E9%9B%86%E5%90%88%E7%AB%9E%E4%BB%B7%E4%BA%A4%E6%98%93%E5%88%B6%E5%BA%A6
[4]: http://wiki.mbalib.com/wiki/%E8%BF%9E%E7%BB%AD%E7%AB%9E%E4%BB%B7